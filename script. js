document.addEventListener('DOMContentLoaded', () => {
  let currentLang = document.documentElement.lang.startsWith('ar') ? 'ar' : 'fr';

  // ğŸ•’ Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
  function updateTime() {
    const now = new Date();
    const daysAr = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
    const monthsAr = ['Ø¬Ø§Ù†ÙÙŠ','ÙÙŠÙØ±ÙŠ','Ù…Ø§Ø±Ø³','Ø£ÙØ±ÙŠÙ„','Ù…Ø§ÙŠ','Ø¬ÙˆØ§Ù†','Ø¬ÙˆÙŠÙ„ÙŠØ©','Ø£ÙˆØª','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
    const daysFr = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
    const monthsFr = ['Janvier','FÃ©vrier','Mars','Avril','Mai','Juin','Juillet','AoÃ»t','Septembre','Octobre','Novembre','DÃ©cembre'];

    let day = currentLang === 'ar' ? daysAr[now.getDay()] : daysFr[now.getDay()];
    let month = currentLang === 'ar' ? monthsAr[now.getMonth()] : monthsFr[now.getMonth()];
    let date = now.getDate();
    let timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
    let dateStr = currentLang === 'ar' 
      ? `${day}ØŒ ${date} ${month}` 
      : `${day}, ${date} ${month}`;
      
    document.getElementById('current-time').textContent = `${dateStr} - ${timeStr}`;
  }

  // ğŸ‘ï¸ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  function updateVisits() {
    const key = 'aem-visit-count';
    let count = parseInt(localStorage.getItem(key)) || 0;
    count++;
    localStorage.setItem(key, count);
    document.getElementById('visit-count').textContent = 
      currentLang === 'ar' ? `Ø¹Ø¯Ø¯ Ø²ÙŠØ§Ø±Ø§ØªÙƒ: ${count}` : `Nombre de visites: ${count}`;
  }

  // ğŸ—ï¸ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙŠØªØ­Ø±Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  const newsAr = [
    "ğŸ“¢ ÙˆØ±Ø´Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙƒ Ø§Ù„Ø±Ø­Ù…Ø§Ù†ÙŠ ØªÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨Ù‡Ø§ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª.",
    "ğŸ”§ Ø®Ø¯Ù…Ø§Øª ØªØµÙ„ÙŠØ­ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§ÙØ³Ø©.",
    "ğŸšš ØªÙˆØµÙŠÙ„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…ØªÙˆÙØ± Ù„ÙƒÙ„ Ø£Ù†Ø­Ø§Ø¡ ØªÙˆÙ†Ø³.",
    "ğŸ“± ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±."
  ];
  const newsFr = [
    "ğŸ“¢ Atelier Electronique MÃ©denine est ouvert pour toutes les rÃ©gions.",
    "ğŸ”§ RÃ©paration d'appareils Ã©lectroniques avec haute qualitÃ© et bon prix.",
    "ğŸšš Livraison disponible dans toute la Tunisie.",
    "ğŸ“± Contactez-nous sur WhatsApp pour toute demande."
  ];

  function rotateNews() {
    const news = currentLang === 'ar' ? newsAr : newsFr;
    const ticker = document.getElementById('live-news');
    let index = 0;
    ticker.textContent = news[index];
    setInterval(() => {
      index = (index + 1) % news.length;
      ticker.textContent = news[index];
    }, 5000);
  }

  // â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
  function initFAQ() {
    document.querySelectorAll('.faq-item').forEach(item => {
      item.onclick = () => item.classList.toggle('open');
    });
  }

  // ğŸŒ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
  document.getElementById('toggle-lang-btn').addEventListener('click', () => {
    currentLang = currentLang === 'ar' ? 'fr' : 'ar';
    document.documentElement.lang = currentLang;
    document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
    document.querySelector('header h1').textContent = "Atelier Electronique MÃ©denine";
    document.querySelector('.experience-badge').textContent = 
      currentLang === 'ar' ? "ğŸŒ¼ Ø£ÙƒØ«Ø± Ù…Ù† 10 Ø³Ù†ÙˆØ§Øª Ø®Ø¨Ø±Ø©" : "ğŸŒ¼ Plus de 10 ans d'expÃ©rience";
    document.getElementById('toggle-lang-btn').textContent = 
      currentLang === 'ar' ? "ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©" : "Changer la langue";

    document.getElementById('visit-count').textContent = 
      currentLang === 'ar' ? `Ø¹Ø¯Ø¯ Ø²ÙŠØ§Ø±Ø§ØªÙƒ: ${localStorage.getItem('aem-visit-count')}` 
                           : `Nombre de visites: ${localStorage.getItem('aem-visit-count')}`;

    document.querySelector('.faq h2').textContent = 
      currentLang === 'ar' ? "Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©" : "FAQ";

    const faqItems = document.querySelectorAll('.faq-item');
    const faqContent = currentLang === 'ar'
      ? [
          { q: "ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù‡Ø§Ø² Ù„Ù„Ø¥ØµÙ„Ø§Ø­ØŸ", a: "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„ØªØ±ØªÙŠØ¨ Ø§Ø³ØªÙ„Ø§Ù…Ù‡." },
          { q: "ÙƒÙ… Ù…Ø¯Ø© Ø§Ù„ØªØµÙ„ÙŠØ­ Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø©ØŸ", a: "ØªØªØ±Ø§ÙˆØ­ Ø¨ÙŠÙ† ÙŠÙˆÙ… Ø¥Ù„Ù‰ 3 Ø£ÙŠØ§Ù… Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„." },
          { q: "Ù‡Ù„ ØªØ³ØªØ®Ø¯Ù…ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£ØµÙ„ÙŠØ©ØŸ", a: "Ù†Ø¹Ù…ØŒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ø£ØµÙ„ÙŠØ© Ø£Ùˆ Ù…ÙƒØ§ÙØ¦Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©." },
          { q: "ÙƒÙŠÙ Ø£ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø¬Ù‡Ø§Ø²ÙŠØŸ", a: "Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ø¨Ø± Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨." }
        ]
      : [
          { q: "Comment envoyer mon appareil pour rÃ©paration ?", a: "Par poste ou en nous contactant pour la collecte." },
          { q: "Quel est le dÃ©lai habituel de rÃ©paration ?", a: "Entre 1 et 3 jours selon la panne." },
          { q: "Utilisez-vous des piÃ¨ces d'origine ?", a: "Oui, toutes les piÃ¨ces sont dâ€™origine ou de qualitÃ© Ã©quivalente." },
          { q: "Comment suivre lâ€™Ã©tat de mon appareil ?", a: "On vous envoie photos et vidÃ©os via WhatsApp." }
        ];

    faqItems.forEach((item, i) => {
      item.classList.remove('open');
      item.querySelector('h3').textContent = faqContent[i].q;
      item.querySelector('.answer').textContent = faqContent[i].a;
    });

    updateTime();
    rotateNews();
  });

  // â³ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
  updateTime();
  rotateNews();
  updateVisits();
  initFAQ();
  setInterval(updateTime, 1000);
});
