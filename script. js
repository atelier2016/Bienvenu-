// script.js - Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ© AEM-site ØªØµÙ…ÙŠÙ… Ø¥ÙŠØ·Ø§Ù„ÙŠ
document.addEventListener("DOMContentLoaded", function () {
  // Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
  const timeEl = document.getElementById("time");
  setInterval(() => {
    const now = new Date();
    timeEl.textContent = now.toLocaleString("fr-TN");
  }, 1000);

  // Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± localStorage
  const visitsEl = document.getElementById("visits");
  let visits = localStorage.getItem("visitsAEM");
  visits = visits ? parseInt(visits) + 1 : 1;
  localStorage.setItem("visitsAEM", visits);
  visitsEl.textContent = visits;

  // Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
  const langBtn = document.getElementById("langToggle");
  langBtn.addEventListener("click", toggleLanguage);

  function toggleLanguage() {
    document.body.classList.toggle("fr");
    if (document.body.classList.contains("fr")) {
      langBtn.textContent = "ðŸ‡¹ðŸ‡³ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©";
    } else {
      langBtn.textContent = "ðŸ‡«ðŸ‡· FranÃ§ais";
    }
  }

  // Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ
  const radio = document.getElementById("quranRadio");
  const playBtn = document.getElementById("playRadio");
  playBtn.addEventListener("click", () => {
    if (radio.paused) {
      radio.play();
      playBtn.textContent = "â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ";
    } else {
      radio.pause();
      playBtn.textContent = "â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ";
    }
  });

  // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
  document.querySelectorAll(".faq-question").forEach((q) => {
    q.addEventListener("click", () => {
      q.classList.toggle("open");
      const answer = q.nextElementSibling;
      if (answer.style.maxHeight) {
        answer.style.maxHeight = null;
      } else {
        answer.style.maxHeight = answer.scrollHeight + "px";
      }
    });
  });

  // ØªØ­Ù…ÙŠÙ„ Ø´Ø±ÙŠØ· Ø£Ø®Ø¨Ø§Ø± BBC
  fetch("https://api.rss2json.com/v1/api.json?rss_url=https://feeds.bbci.co.uk/arabic/rss.xml")
    .then((res) => res.json())
    .then((data) => {
      const newsContainer = document.getElementById("news");
      newsContainer.innerHTML = "";
      data.items.slice(0, 5).forEach((item) => {
        const span = document.createElement("span");
        span.textContent = "ðŸ—žï¸ " + item.title;
        newsContainer.appendChild(span);
      });
    })
    .catch(() => {
      document.getElementById("news").textContent = "âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±";
    });

  // Lightbox Ù„Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
  const lightbox = document.createElement("div");
  lightbox.id = "lightbox";
  document.body.appendChild(lightbox);

  document.querySelectorAll(".gallery img, .video-preview").forEach((media) => {
    media.addEventListener("click", () => {
      lightbox.classList.add("active");
      const clone = media.cloneNode(true);
      lightbox.innerHTML = "";
      lightbox.appendChild(clone);
    });
  });

  lightbox.addEventListener("click", () => {
    lightbox.classList.remove("active");
  });
});
